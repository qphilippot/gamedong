<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>MAP - Test</title>
    <style>
      .gd-viewport {
        background: red;
      }
    </style>
  </head>
  <body>
    <main id='gd-main-viewport'></main>
    <img id='test-id'>
    <script>
      var page = {};
        document.addEventListener('DOMContentLoaded', function() {
          page.viewport = new GameDong.ViewPort({
            container: 'gd-main-viewport',
            size: {
              width: 500,
              height: 500
            }
          });

          page.map = new GameDong.TileMap({
            name: 'custom-map',
            nbRows: 100,
            nbColumns: 100
          });

          Promise.all([
            GameDong.AssetManager.getImage('a'),
            GameDong.AssetManager.getImage('tile'),
            GameDong.AssetManager.getImage('b'),
          ]).then(images => {
                const x_max = page.map.getNbColumns();           
                const y_max = page.map.getNbRows();
                // create game element from as

                let elt = null;
                
                
                for (let x = 0; x < x_max; x++) {
                  for (let y = 0; y < y_max; y++) {
                    const image = images[Math.round(Math.random() * (images.length - 1))];
                    elt = new GameDong.GameElement();
                    elt.name = image.name;
                    elt.setTexture(image);

                    page.map.add(elt, x, y, 0);
                  }  
                }

            page.camera = new GameDong.Camera({
              radius: 5,
              position: {
                x: 0.5,
                y: 0.5
              }
            });
            
            page.camera.setScene(page.map);
            page.camera.snapshot(page.viewport);
            // page.map.getRenderingData().forEach(function(data) {
            //   data.gameElement.render(
            //     page.viewport.getContext(), 
            //     data.x * resolution.width, 
            //     data.y * resolution.height,
            //     data.width * resolution.width,
            //     data.height * resolution.height,
            //   )
            // });

          })
        });
    </script>

  </body>
</html>