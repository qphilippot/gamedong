<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>MAP - Test</title>
    <link href="../src/style/gamedong.css" rel="stylesheet">
  </head>
  <body>
    <main id='gd-main-viewport'></main>
    <img id='test-id'>
    <script>
      var page = {};
        document.addEventListener('DOMContentLoaded', function() {
          const viewport = new GameDong.ViewPort({
            container: 'gd-main-viewport',
            size: {
              width: 500,
              height: 500
            }
          });

          page.viewport = viewport;
          
          const scene = GameDong.Scene.create(); 
          page.scene = scene;
          scene.bindTo(viewport)

          var xMax = 100;
          var yMax = 100;
          page.scene.setEnvironment(new GameDong.TileMap({
            name: 'custom-map',
            nbColumns: xMax,
            nbRows: yMax
          }));

          GameDong.tileset = new GameDong.TileSet({
            name: 'grass',
            assetManager: GameDong.AssetManager
          });

          Promise.all(
            Object.keys(GameDong.AssetManager.ressources)
              .map(
                name => GameDong.AssetManager.getImage(name)
              )
          ).then(images => {
                const map = page.scene.getEnvironment();
                const x_max = map.getNbColumns();           
                const y_max = map.getNbRows();
                // create game element from as

                let elt = null;

                scene.increaseCapacity(x_max * y_max);
                
                
                for (let x = 0; x < x_max; x++) {
                  for (let y = 0; y < y_max; y++) {
                    const image = images[Math.round(Math.random() * (images.length - 1))];
                    elt = new GameDong.GameElement();
                    elt.name = image.name;
                    elt.setTexture(image);

                    scene.add(elt, x, y, 0);
                  }  
                }

            
            scene.render();
            
            document.addEventListener('keydown', function(event) {
              var delta = {x: 0, y: 0};
              switch(event.keyCode) {
                // left
                case 37:
                  delta.x -= 1 / xMax;
                  break;

                // up
                case 38:
                  delta.y -= 1 / yMax;
                  break;

                // right
                case 39:
                  delta.x += 1 / xMax;
                  break;

                // down
                case 40:
                  delta.y += 1 / yMax;
                  break;
              }

                page.scene.move(delta.x, delta.y);
                page.scene.render();
            });
          })
        });
    </script>

  <script type="text/javascript" src="gamedong-engine.js"></script></body>
</html>